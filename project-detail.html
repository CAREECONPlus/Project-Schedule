<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê°à‰ª∂Ë©≥Á¥∞ - Ê°à‰ª∂ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/project-detail.css">
</head>
<body>
    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="header-left">
                    <a href="index.html" class="back-btn">
                        <span>‚Üê</span>
                        „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´Êàª„Çã
                    </a>
                    <h1 class="header-title" id="projectTitle">Ê°à‰ª∂Ë©≥Á¥∞</h1>
                </div>
                <nav class="header-nav">
                    <a href="index.html" class="nav-link">„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</a>
                    <a href="site-management.html" class="nav-link">ÁèæÂ†¥ÁÆ°ÁêÜ</a>
                    <a href="gantt-chart.html" class="nav-link">Â∑•Á®ãË°®</a>
                </nav>
                <div class="header-actions">
                    <button class="btn btn-outline" id="editProjectBtn">Á∑®ÈõÜ</button>
                    <button class="btn btn-danger" id="deleteProjectBtn">ÂâäÈô§</button>
                </div>
            </div>
        </div>
    </header>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <main class="main">
        <div class="container">
            <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÔºÜ„ÇØ„Ç§„ÉÉ„ÇØ„Ç¢„ÇØ„Ç∑„Éß„É≥ -->
            <section class="status-section">
                <div class="row">
                    <div class="col-8">
                        <div class="status-card">
                            <div class="status-current">
                                <span class="status-label">ÁèæÂú®„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ</span>
                                <div class="status-display">
                                    <span class="status-badge" id="currentStatus">Ë¶ãÁ©ç</span>
                                    <button class="btn btn-sm btn-primary" id="changeStatusBtn">„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥</button>
                                </div>
                            </div>
                            <div class="status-progress" id="statusProgress">
                                <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÈÄ≤Êçó„Éê„Éº„ÅåÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="quick-actions">
                            <h3>„ÇØ„Ç§„ÉÉ„ÇØ„Ç¢„ÇØ„Ç∑„Éß„É≥</h3>
                            <div class="action-buttons">
                                <button class="action-btn" id="callClientBtn">
                                    <span class="action-icon">üìû</span>
                                    È°ßÂÆ¢„Å´ÈõªË©±
                                </button>
                                <button class="action-btn" id="emailClientBtn">
                                    <span class="action-icon">‚úâÔ∏è</span>
                                    „É°„Éº„É´ÈÄÅ‰ø°
                                </button>
                                <button class="action-btn" id="generateReportBtn">
                                    <span class="action-icon">üìÑ</span>
                                    Â†±ÂëäÊõ∏‰ΩúÊàê
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Âü∫Êú¨ÊÉÖÂ†± -->
            <section class="info-section">
                <div class="row">
                    <div class="col-8">
                        <div class="card">
                            <div class="card-header">
                                <h2>Âü∫Êú¨ÊÉÖÂ†±</h2>
                            </div>
                            <div class="card-body">
                                <div class="info-grid">
                                    <div class="info-item">
                                        <label>Ê°à‰ª∂Âêç</label>
                                        <span id="projectName">-</span>
                                    </div>
                                    <div class="info-item">
                                        <label>È°ßÂÆ¢Âêç</label>
                                        <span id="clientName">-</span>
                                    </div>
                                    <div class="info-item">
                                        <label>ÈõªË©±Áï™Âè∑</label>
                                        <span id="clientPhone">-</span>
                                    </div>
                                    <div class="info-item">
                                        <label>„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                                        <span id="clientEmail">-</span>
                                    </div>
                                    <div class="info-item full-width">
                                        <label>‰ΩèÊâÄ</label>
                                        <span id="clientAddress">-</span>
                                    </div>
                                    <div class="info-item">
                                        <label>„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éû„Éç„Éº„Ç∏„É£„Éº</label>
                                        <span id="projectManager">-</span>
                                    </div>
                                    <div class="info-item">
                                        <label>ÁèæÂ†¥ÁÆ°ÁêÜËÄÖ</label>
                                        <span id="siteManager">-</span>
                                    </div>
                                    <div class="info-item full-width">
                                        <label>ÂÇôËÄÉ</label>
                                        <span id="projectNotes">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="card">
                            <div class="card-header">
                                <h2>ÈáëÈ°ç„Éª„Çπ„Ç±„Ç∏„É•„Éº„É´</h2>
                            </div>
                            <div class="card-body">
                                <div class="amount-schedule">
                                    <div class="amount-item">
                                        <label>Ë¶ãÁ©çÈáëÈ°ç</label>
                                        <span class="amount" id="estimateAmount">¬•0</span>
                                    </div>
                                    <div class="amount-item">
                                        <label>Â•ëÁ¥ÑÈáëÈ°ç</label>
                                        <span class="amount contract" id="contractAmount">¬•0</span>
                                    </div>
                                    <div class="schedule-item">
                                        <label>ÁùÄÂ∑•‰∫àÂÆöÊó•</label>
                                        <span id="startDate">-</span>
                                    </div>
                                    <div class="schedule-item">
                                        <label>ÂÆå‰∫Ü‰∫àÂÆöÊó•</label>
                                        <span id="endDate">-</span>
                                    </div>
                                    <div class="schedule-item">
                                        <label>ÂÆüÁùÄÂ∑•Êó•</label>
                                        <span id="actualStartDate">-</span>
                                    </div>
                                    <div class="schedule-item">
                                        <label>ÂÆüÂÆå‰∫ÜÊó•</label>
                                        <span id="actualEndDate">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÂ±•Ê≠¥ -->
            <section class="history-section">
                <div class="card">
                    <div class="card-header">
                        <h2>„Çπ„ÉÜ„Éº„Çø„ÇπÂ±•Ê≠¥</h2>
                    </div>
                    <div class="card-body">
                        <div class="timeline" id="statusHistory">
                            <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÂ±•Ê≠¥„ÅåÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- ‰ΩúÊ•≠ËÄÖ„Éª„ÉÅ„Éº„É† -->
            <section class="team-section">
                <div class="card">
                    <div class="card-header">
                        <h2>‰ΩúÊ•≠„ÉÅ„Éº„É†</h2>
                        <button class="btn btn-sm btn-outline" id="editTeamBtn">Á∑®ÈõÜ</button>
                    </div>
                    <div class="card-body">
                        <div class="team-grid" id="teamMembers">
                            <!-- „ÉÅ„Éº„É†„É°„É≥„Éê„Éº„ÅåÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„É¢„Éº„ÉÄ„É´ -->
    <div class="modal" id="statusChangeModal">
        <div class="modal-backdrop" onclick="closeModal('statusChangeModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥</h3>
                <button class="modal-close" onclick="closeModal('statusChangeModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="statusChangeForm">
                    <div class="form-group">
                        <label class="form-label">ÁèæÂú®„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ</label>
                        <span id="currentStatusDisplay" class="status-badge">Ë¶ãÁ©ç</span>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="newStatus">Êñ∞„Åó„ÅÑ„Çπ„ÉÜ„Éº„Çø„Çπ *</label>
                        <select class="form-control" id="newStatus" required>
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="Ë¶ãÁ©ç">Ë¶ãÁ©ç</option>
                            <option value="ÂèóÊ≥®">ÂèóÊ≥®</option>
                            <option value="ÊñΩÂ∑•Ââç">ÊñΩÂ∑•Ââç</option>
                            <option value="ÊñΩÂ∑•‰∏≠">ÊñΩÂ∑•‰∏≠</option>
                            <option value="ÊñΩÂ∑•ÂÆå‰∫Ü">ÊñΩÂ∑•ÂÆå‰∫Ü</option>
                            <option value="Ê°à‰ª∂ÂÆå‰∫Ü">Ê°à‰ª∂ÂÆå‰∫Ü</option>
                        </select>
                    </div>

                    <div class="form-group" id="contractAmountGroup" style="display: none;">
                        <label class="form-label" for="statusContractAmount">Â•ëÁ¥ÑÈáëÈ°ç</label>
                        <input type="number" class="form-control" id="statusContractAmount" step="1000" placeholder="ÂèóÊ≥®ÊôÇ„ÅØÂ•ëÁ¥ÑÈáëÈ°ç„ÇíÂÖ•Âäõ">
                    </div>

                    <div class="form-group" id="actualDateGroup" style="display: none;">
                        <label class="form-label" for="actualDate">ÂÆüÁ∏æÊó•‰ªò</label>
                        <input type="date" class="form-control" id="actualDate">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="statusNotes">Â§âÊõ¥ÁêÜÁî±„ÉªÂÇôËÄÉ</label>
                        <textarea class="form-control" id="statusNotes" rows="3" placeholder="„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„ÅÆÁêÜÁî±„ÇÑÂÇôËÄÉ„ÇíÂÖ•Âäõ"></textarea>
                    </div>

                    <div class="alert-box" id="autoTicketAlert" style="display: none;">
                        <div class="alert-icon">‚ÑπÔ∏è</div>
                        <div class="alert-content">
                            <strong>Ëá™ÂãïËµ∑Á•®„Å´„Å§„ÅÑ„Å¶</strong><br>
                            „ÄåÂèóÊ≥®„Äç„Å´Â§âÊõ¥„Åô„Çã„Å®„ÄÅÁèæÂ†¥ÁÆ°ÁêÜËÄÖ„Å´Ëá™Âãï„ÅßÊ°à‰ª∂„ÅåËµ∑Á•®„Åï„Çå„Åæ„Åô„ÄÇ
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('statusChangeModal')">„Ç≠„É£„É≥„Çª„É´</button>
                <button type="submit" class="btn btn-primary" form="statusChangeForm" id="confirmStatusChange">Â§âÊõ¥</button>
            </div>
        </div>
    </div>

    <!-- Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
    <div class="modal" id="editProjectModal">
        <div class="modal-backdrop" onclick="closeModal('editProjectModal')"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Ê°à‰ª∂Á∑®ÈõÜ</h3>
                <button class="modal-close" onclick="closeModal('editProjectModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editProjectForm">
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label" for="editProjectName">Ê°à‰ª∂Âêç *</label>
                                <input type="text" class="form-control" id="editProjectName" required>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label" for="editClientName">È°ßÂÆ¢Âêç *</label>
                                <input type="text" class="form-control" id="editClientName" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label" for="editClientPhone">ÈõªË©±Áï™Âè∑</label>
                                <input type="tel" class="form-control" id="editClientPhone">
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label" for="editClientEmail">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                                <input type="email" class="form-control" id="editClientEmail">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="editClientAddress">‰ΩèÊâÄ</label>
                        <input type="text" class="form-control" id="editClientAddress">
                    </div>

                    <div class="row">
                        <div class="col-4">
                            <div class="form-group">
                                <label class="form-label" for="editEstimateAmount">Ë¶ãÁ©çÈáëÈ°ç</label>
                                <input type="number" class="form-control" id="editEstimateAmount" step="1000">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-group">
                                <label class="form-label" for="editStartDate">ÁùÄÂ∑•‰∫àÂÆöÊó•</label>
                                <input type="date" class="form-control" id="editStartDate">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-group">
                                <label class="form-label" for="editEndDate">ÂÆå‰∫Ü‰∫àÂÆöÊó•</label>
                                <input type="date" class="form-control" id="editEndDate">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label" for="editProjectManager">„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éû„Éç„Éº„Ç∏„É£„Éº</label>
                                <select class="form-control" id="editProjectManager">
                                    <!-- ÂãïÁöÑ„Å´ËøΩÂä† -->
                                </select>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label class="form-label" for="editSiteManager">ÁèæÂ†¥ÁÆ°ÁêÜËÄÖ</label>
                                <select class="form-control" id="editSiteManager">
                                    <!-- ÂãïÁöÑ„Å´ËøΩÂä† -->
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="editProjectNotes">ÂÇôËÄÉ</label>
                        <textarea class="form-control" id="editProjectNotes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('editProjectModal')">„Ç≠„É£„É≥„Çª„É´</button>
                <button type="submit" class="btn btn-primary" form="editProjectForm">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <!-- Á¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞ -->
    <div class="modal" id="confirmModal">
        <div class="modal-backdrop" onclick="closeModal('confirmModal')"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3 id="confirmTitle">Á¢∫Ë™ç</h3>
                <button class="modal-close" onclick="closeModal('confirmModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('confirmModal')">„Ç≠„É£„É≥„Çª„É´</button>
                <button type="button" class="btn btn-danger" id="confirmButton">ÂâäÈô§</button>
            </div>
        </div>
    </div>

    <!-- ÈÄöÁü•„Éà„Éº„Çπ„Éà -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- JavaScript -->
    <script src="js/utils.js"></script>
    <script src="js/data-manager.js"></script>
    <script src="js/project-handler.js"></script>
    <script src="js/status-manager.js"></script>
    <script src="js/app.js"></script>
    <script>
        // URL„Éë„É©„É°„Éº„Çø„Åã„ÇâÊ°à‰ª∂ID„ÇíÂèñÂæó
        const urlParams = new URLSearchParams(window.location.search);
        const projectId = urlParams.get('id');

        // „Éö„Éº„Ç∏ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            if (!projectId) {
                // ID„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´„É™„ÉÄ„Ç§„É¨„ÇØ„Éà
                window.location.href = 'index.html';
                return;
            }

            // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÂàùÊúüÂåñ
            initializeApp();
            
            // Ê°à‰ª∂„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„ÉªË°®Á§∫
            loadProjectDetail(projectId);
            
            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
            setupEventListeners();
        });

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
        function setupEventListeners() {
            // „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥
            document.getElementById('changeStatusBtn').addEventListener('click', function() {
                openModal('statusChangeModal');
            });

            // Á∑®ÈõÜ
            document.getElementById('editProjectBtn').addEventListener('click', function() {
                openModal('editProjectModal');
            });

            // ÂâäÈô§
            document.getElementById('deleteProjectBtn').addEventListener('click', function() {
                confirmDeleteProject();
            });

            // „Éï„Ç©„Éº„É†ÈÄÅ‰ø°
            document.getElementById('statusChangeForm').addEventListener('submit', function(e) {
                e.preventDefault();
                changeProjectStatus();
            });

            document.getElementById('editProjectForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateProject();
            });

            // „Çπ„ÉÜ„Éº„Çø„ÇπÈÅ∏ÊäûÂ§âÊõ¥ÊôÇ„ÅÆÂá¶ÁêÜ
            document.getElementById('newStatus').addEventListener('change', function() {
                handleStatusSelectChange(this.value);
            });

            // „ÇØ„Ç§„ÉÉ„ÇØ„Ç¢„ÇØ„Ç∑„Éß„É≥
            document.getElementById('callClientBtn').addEventListener('click', function() {
                callClient();
            });

            document.getElementById('emailClientBtn').addEventListener('click', function() {
                emailClient();
            });
        }

        // „É¢„Éº„ÉÄ„É´ÈñãÈñâ
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // „Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„ÉºÈñ¢Êï∞ÔºàÂæå„ÅßÂÆüË£ÖÔºâ
        function initializeApp() {
            console.log('„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÂàùÊúüÂåñ‰∏≠...');
        }

        function loadProjectDetail(id) {
            console.log('Ê°à‰ª∂Ë©≥Á¥∞Ë™≠„ÅøËæº„Åø‰∏≠...', id);
        }

        function changeProjectStatus() {
            console.log('„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥‰∏≠...');
        }

        function updateProject() {
            console.log('Ê°à‰ª∂Êõ¥Êñ∞‰∏≠...');
        }

        function confirmDeleteProject() {
            console.log('Ê°à‰ª∂ÂâäÈô§Á¢∫Ë™ç...');
        }

        function handleStatusSelectChange(status) {
            console.log('„Çπ„ÉÜ„Éº„Çø„ÇπÈÅ∏ÊäûÂ§âÊõ¥:', status);
        }

        function callClient() {
            console.log('È°ßÂÆ¢„Å´ÈõªË©±...');
        }

        function emailClient() {
            console.log('„É°„Éº„É´ÈÄÅ‰ø°...');
        }
    </script>
</body>
</html>
